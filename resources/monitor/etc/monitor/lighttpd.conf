# lighttpd config for allow monitor (CGI, no Flask)
# Port 8888, document-root = app dir, /api/* -> cgi-bin/api.cgi with PATH_INFO

server.port = 8888
server.bind = "0.0.0.0"
server.document-root = "/opt/etc/allow/monitor"

# Modules: rewrite before cgi so /api/* is rewritten; indexfile before cgi (lighttpd requires this order)
server.modules = (
    "mod_access",
    "mod_rewrite",
    "mod_indexfile",
    "mod_cgi",
    "mod_staticfile"
)

# /api/<service>/config/full -> config.cgi; rest -> api.cgi (order matters: first match wins)
url.rewrite-once = (
    "^/api/(stubby|stubby-family|dnsmasq|dnsmasq-family)/config/full" => "/cgi-bin/config.cgi/$1/config/full",
    "^/api(.*)" => "/cgi-bin/api.cgi$1"
)

# Execute .cgi scripts; empty string = run target file as CGI
cgi.assign = ( ".cgi" => "" )

# Default index
index-file.names = ( "index.html" )

# MIME
mimetype.assign = (
    ".html" => "text/html",
    ".css"  => "text/css",
    ".js"   => "application/javascript",
    ".json" => "application/json",
    ".ico"  => "image/x-icon"
)
