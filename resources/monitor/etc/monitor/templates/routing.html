{% extends "base.html" %}

{% block title %}Маршрутизация - Allow{% endblock %}

{% block content %}
<div class="settings-page routing-page">
    <header class="settings-page-header" role="banner">
        <h1>Маршрутизация</h1>
        <div class="settings-save-bar" id="routing-save-bar" aria-live="polite">
            <span class="settings-unsaved-hint" id="routing-unsaved-hint"></span>
            <button type="button" class="btn btn-primary" id="save-routing-changes-btn" onclick="saveAllRoutingChanges()" disabled>Сохранить</button>
        </div>
    </header>

    <!-- Мобильные табы: переключение колонок (видно только на узких экранах) -->
    <div class="routing-mobile-tabs" role="tablist" aria-label="Тип маршрутизации">
        <button type="button" class="routing-mobile-tab active" role="tab" aria-selected="true" data-column="direct">Напрямую</button>
        <button type="button" class="routing-mobile-tab" role="tab" aria-selected="false" data-column="bypass">Обход</button>
        <button type="button" class="routing-mobile-tab" role="tab" aria-selected="false" data-column="vpn">VPN</button>
    </div>

    <div class="routing-columns">
        <!-- Колонка 1: Напрямую -->
        <div class="routing-column mobile-active" id="direct-column" data-column="direct">
            <div class="column-header">
                <h2>Напрямую</h2>
                <button class="btn btn-primary btn-sm" onclick="addBlock('direct')">+ Добавить блок</button>
            </div>
            <div class="blocks-container" id="direct-blocks">
                <!-- Блоки будут загружены через JS -->
            </div>
        </div>

        <!-- Колонка 2: Встроенные инструменты обхода -->
        <div class="routing-column" id="bypass-column" data-column="bypass">
            <div class="column-header">
                <h2>Встроенные инструменты обхода</h2>
                <button class="btn btn-primary btn-sm" onclick="addBlock('bypass')">+ Добавить блок</button>
            </div>
            <div class="blocks-container" id="bypass-blocks">
                <!-- Блоки будут загружены через JS -->
            </div>
        </div>

        <!-- Колонка 3: VPN -->
        <div class="routing-column" id="vpn-column" data-column="vpn">
            <div class="column-header">
                <h2>VPN</h2>
                <button class="btn btn-primary btn-sm" onclick="addBlock('vpn')">+ Добавить блок</button>
            </div>
            <div class="blocks-container" id="vpn-blocks">
                <!-- Блоки будут загружены через JS -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
    {% include 'partials/modal-config-editor.html' %}
    
    <!-- Модальное окно добавления блока -->
    <div id="addBlockModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="addBlockModalTitle">Добавить блок</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="addBlockName">Название блока</label>
                    <input type="text" id="addBlockName" class="form-input" placeholder="Введите название">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddBlockModal()">Отмена</button>
                <button class="btn btn-primary" id="addBlockSubmitBtn" onclick="submitAddBlock()">Добавить</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='routing.js') }}"></script>
{% endblock %}

